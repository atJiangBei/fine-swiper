!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).FineSwiper=e()}(this,(function(){"use strict";const t=Date.now||function(){return+new Date},e=function(){};class i{constructor(t){this.root=t.root,this.direction=t.direction,this.loop=t.loop,this.auto=t.auto,this.delayed=t.delayed,this.startTime=0,this.callback=t.callback||e,this.enter=t.enter||e,this.startingPoint=0,this.isTracking=!1,this.captureClick=!1,this.disabledHandSlideing=!!t.disabledHand,this.timer=null,this.defaultIndex=this.loop?-1:0,this.slider=this.root.children[0],this.children=this.slider.children;const i=this.children;this.length=i.length;const s=i[0],{width:h,height:n}=s.getBoundingClientRect();this.scaleWidth=h,this.scaleHeight=n,this.scaleSize="horizontal"===this.direction?h:n,this._closeDefault=t=>{this.closeDefault(t)},this.slider.addEventListener("click",this._closeDefault,!0),document.addEventListener("visibilitychange",this._visibilitychange.bind(this))}closeDefault(t){const e=t||event;this.captureClick&&(e.preventDefault(),e.stopPropagation())}_visibilitychange(){}clear(){window.clearInterval(this.timer)}startMove(t,e,i=30,s){let h=t;const n=e;let l;const a=new Promise((t=>l=t)),d=()=>{h<n?(h+=i,h>=n&&(h=n)):h>n&&(h-=i,h<=n&&(h=n)),s(h),t>e&&(h>n?window.requestAnimationFrame(d):l()),t<e&&(h<n?window.requestAnimationFrame(d):l())};return window.requestAnimationFrame(d),a}}class s extends i{constructor(t){super(t);const e=this.scaleSize;this.speed=Math.ceil(.08*e),this.initSetIndex(t.index),this.isLoop(),this.auto&&(this.timer=this.setInterval()),this._start=t=>{this.start(t)},this._move=t=>{this.move(t)},this._end=t=>{this.end(t)},this.slider.addEventListener("touchstart",this._start,this.will),this.slider.addEventListener("touchmove",this._move,this.will),this.slider.addEventListener("touchend",this._end,this.will),this.slider.addEventListener("touchcancel",this._end,this.will),this.slider.addEventListener("mousedown",this._start,this.will),this.slider.addEventListener("mousemove",this._move,this.will),this.slider.addEventListener("mouseup",this._end,this.will)}_visibilitychange(){document.hidden?this.clear():this.auto&&(this.timer=this.setInterval())}isLoop(){const t=this.children,e=this.length;if(this.loop){const i=t[0].cloneNode(!0),s=t[e-1].cloneNode(!0);this.slider.appendChild(i),this.slider.insertBefore(s,t[0])}}initSetIndex(t){t=Math.min(Math.abs(t),this.length-1),this.loop?this.defaultIndex=-(t+1):this.defaultIndex=-t,this.slideMove(this.defaultIndex*this.scaleSize),this.index=t}setInterval(){return window.setInterval(this.aotoplay.bind(this),this.delayed)}start(e){const i=e||event;"mousedown"===i.type&&i.preventDefault();const s=i.touches,h=s?s[0]:i,{direction:n,disabledHandSlideing:l}=this;this.startingPoint="horizontal"===n?h.clientX:h.clientY,this.startTime=t(),this.isTracking=!0,this.captureClick=!1}move(t){if(!this.isTracking)return;const e=t||event;"mousemove"===e.type&&(this.captureClick=!0),e.preventDefault();const{disabledHandSlideing:i,direction:s}=this;if(i)return;const h=e.changedTouches,n=h?h[0]:e,l="horizontal"===s?n.clientX-this.startingPoint:n.clientY-this.startingPoint;this.clear(),this.slideProcess(l+this.defaultIndex*this.scaleSize,l)}end(e){if(!this.isTracking)return;if(this.isTracking=!1,this.disabledHandSlideing)return;const i=e||event,s=i.changedTouches,h=s?s[0]:i;let n="horizontal"===this.direction?h.clientX-this.startingPoint:h.clientY-this.startingPoint;if(0===Math.abs(n))return;const l=t()-this.startTime,a=Math.abs(n)>this.scaleSize/2||l<300,d=this.loop,o=this.length,r=-(this.length-1),c=-(this.length+1),u=this.speed,v=this.defaultIndex;let f=u;const x=n>0?1:-1;if(d){let t=v*this.scaleSize+n;a&&(this.defaultIndex+=x,n>0?this.defaultIndex>0&&(this.defaultIndex=0):Math.abs(this.defaultIndex)>Math.abs(c)&&(this.defaultIndex=c)),this.numericalConversion(this.defaultIndex);const e=this.defaultIndex*this.scaleSize;this.startMove(t,e,f,(t=>{this.slideMove(t)})).then((()=>{this.defaultIndex<=c&&(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize)),this.defaultIndex>=0&&(this.defaultIndex=-o,this.slideMove(this.defaultIndex*this.scaleSize)),this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}else{if(a)n>0?this.defaultIndex<0?this.defaultIndex+=x:n/=3:Math.abs(this.defaultIndex)<Math.abs(r)?this.defaultIndex+=x:n/=3;else{const t=this.defaultIndex*this.scaleSize+n,e=this.scaleSize*r;(t>0||t<e)&&(n/=3)}this.numericalConversion(this.defaultIndex);let t=v*this.scaleSize+n;const e=this.defaultIndex*this.scaleSize;this.startMove(t,e,f,(t=>{this.slideMove(t)})).then((()=>{this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}}slideProcess(t,e){if(this.loop)t>=0?(this.defaultIndex=-this.length,this.slideMove(this.defaultIndex*this.scaleSize)):t<=-(this.length+1)*this.scaleSize?(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize)):this.slideMove(t);else if(t>=0)t/=3,this.slideMove(t);else{const i=this.length-1;t<=this.scaleSize*-i&&(e/=3,t=this.scaleSize*-i+e),this.slideMove(t)}}numericalConversion(t){let e;if(this.loop){switch(t){case-1:case-(this.length+1):e=0;break;case 0:e=this.length-1;break;default:e=Math.abs(t)-1}e!==this.index&&(this.index=e),this.callback(this.index)}else e=Math.abs(t),e!==this.index&&(this.index=e,this.callback(this.index))}moveTo(t){this.clear(),t=Math.abs(t);const e=-(this.length+1),i=this.length-1,s=this.speed;t>i&&(t=i);const h=this.index,n=this.index=t,l=this.length;if(this.defaultIndex,h!==n)if(this.loop){if(t===i){t=-l;const i=this.defaultIndex*this.scaleSize,n=t*this.scaleSize;this.defaultIndex=t,this.numericalConversion(this.defaultIndex);const a=Math.abs(h-Math.abs(this.defaultIndex))*s<100?100:Math.abs(h-Math.abs(this.defaultIndex))*s;return void this.startMove(i,n,a,(t=>{this.slideMove(t)})).then((()=>{this.defaultIndex<=e&&(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize)),this.defaultIndex>=0&&(this.defaultIndex=-l,this.slideMove(this.defaultIndex*this.scaleSize)),this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}if(0===t&&this.defaultIndex===e)return this.defaultIndex=-1,void this.slideMove(this.defaultIndex*this.scaleSize);t=-t-1;const n=this.defaultIndex*this.scaleSize,a=t*this.scaleSize;this.defaultIndex=t;const d=Math.max(Math.abs(h-Math.abs(this.defaultIndex)),3)*s;this.numericalConversion(this.defaultIndex),this.startMove(n,a,d,(t=>{this.slideMove(t)})).then((()=>{this.defaultIndex<=e&&(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize)),this.defaultIndex>=0&&(this.defaultIndex=-l,this.slideMove(this.defaultIndex*this.scaleSize)),this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}else{t=-t;const i=Math.max(Math.abs(h-Math.abs(t)),3)*s,n=this.defaultIndex*this.scaleSize,a=t*this.scaleSize;this.defaultIndex=t,this.callback(Math.abs(t)),this.startMove(n,a,i,(t=>{this.slideMove(t)})).then((()=>{this.defaultIndex<=e&&(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize)),this.defaultIndex>=0&&(this.defaultIndex=-l,this.slideMove(this.defaultIndex*this.scaleSize)),this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}}aotoplay(){const t=this.speed;return(()=>{const e=this.defaultIndex,i=-(this.length+1);this.defaultIndex+=-1,this.loop?this.defaultIndex<=i&&(this.defaultIndex=i):this.defaultIndex<=-this.length&&(this.defaultIndex=0),this.numericalConversion(this.defaultIndex);let s=t*Math.abs(Math.abs(e)-Math.abs(this.defaultIndex))/2;const h=e*this.scaleSize,n=this.defaultIndex*this.scaleSize;this.startMove(h,n,s,(t=>{this.slideMove(t)})).then((()=>{this.enter(this.index),this.loop&&this.defaultIndex<=i&&(this.defaultIndex=-1,this.slideMove(this.defaultIndex*this.scaleSize))}))})()}slideMove(t){const e=this.direction,i=this.slider;"horizontal"===e&&(i.style.transform="translate3d("+t+"px,0,0)"),"vertical"===e&&(i.style.transform="translate3d(0,"+t+"px,0)"),i.style.transition=null}destroy(){this.clear(),this.slider.removeEventListener("touchstart",this._start,this.will),this.slider.removeEventListener("touchmove",this._move,this.will),this.slider.removeEventListener("touchend",this._end,this.will),this.slider.removeEventListener("mousedown",this._start,this.will),this.slider.removeEventListener("mousemove",this._move,this.will),this.slider.removeEventListener("mouseup",this._end,this.will),this.slider.removeEventListener("click",this._closeDefault,!0),document.addEventListener("visibilitychange",this._visibilitychange)}}const h=.05;class n extends i{constructor(t){super(t),this.initSetIndex(t.index),this.ifEffectFade(),this.auto&&(this.timer=this.setInterval()),this._start=t=>{this.start(t)},this._move=t=>{this.move(t)},this._end=t=>{this.end(t)},this.slider.addEventListener("touchstart",this._start,this.will),this.slider.addEventListener("touchmove",this._move,this.will),this.slider.addEventListener("touchend",this._end,this.will),this.slider.addEventListener("touchcancel",this._end,this.will),this.slider.addEventListener("mousedown",this._start,this.will),this.slider.addEventListener("mousemove",this._move,this.will),this.slider.addEventListener("mouseup",this._end,this.will)}_visibilitychange(){document.hidden?this.clear():this.auto&&(this.timer=this.setInterval())}setInterval(){return window.setInterval(this.aotoplay.bind(this),this.delayed)}initSetIndex(t){t=Math.min(Math.abs(t),this.length-1),this.index=t}ifEffectFade(){const t=this.children,e=this.scaleHeight,i=this.length;for(let s=0;s<i;s++)t[s].style.transform="translate3d(0,"+-s*e+"px,0)";this.fadeMove(1,this.index)}start(e){const i=e||event;"mousedown"===i.type&&i.preventDefault();const s=i.touches,h=s?s[0]:i;this.startingPoint="horizontal"===this.direction?h.clientX:h.clientY,this.startTime=t(),this.isTracking=!0,this.captureClick=!1,this.disabledHandSlideing}move(t){if(!this.isTracking)return;const e=t||event;if("mousemove"===e.type&&(this.captureClick=!0),e.preventDefault(),this.disabledHandSlideing)return;const i=e.changedTouches,s=i?i[0]:e,h="horizontal"===this.direction?s.clientX-this.startingPoint:s.clientY-this.startingPoint;this.clear();const n=Math.max(0,1-Math.abs(h/this.scaleSize));this.fadeProcess(h,n)}end(e){if(!this.isTracking)return;if(this.isTracking=!1,this.disabledHandSlideing)return;const i=e||event,s=i.changedTouches,n=s?s[0]:i;let l="horizontal"===this.direction?n.clientX-this.startingPoint:n.clientY-this.startingPoint;const a=t()-this.startTime,d=Math.abs(l)>this.scaleSize/2||a<300,o=Math.max(0,1-Math.abs(l/this.scaleSize)),r=this.loop,c=this.index,u=this.length-1;if(0!==Math.abs(l))if(d){const t=this.fadeSetIndex(l),e=r?c:null;t!==parseInt(t+"")&&console.log(128),this.startMove(1-o,1,h,(i=>{this.fadeMove(i,t,e)})).then((()=>{this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}else{let t=this.index;l<0?(t+=1,t>u&&(t=0)):(t-=1,t<0&&(t=u)),this.startMove(o,1,h,(e=>{this.fadeMove(e,this.index,t)})).then((()=>{this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())}))}}moveTo(t){this.clear(),t=Math.abs(t);const e=this.length-1;t>e&&(t=e);const i=this.index,s=this.index=t;s!==i&&(this.callback(s),this.startMove(0,1,h,(t=>{this.fadeMove(t,s,i)})).then((()=>{this.enter(this.index),this.auto&&(this.clear(),this.timer=this.setInterval())})))}fadeMove(t=1,e,i){let s=this.length,h=this.children;for(let t=0;t<s;t++)h[t].style.opacity=0,h[t].style["z-index"]=0;try{h[e].style.opacity=t,h[e].style["z-index"]=1,"number"==typeof i&&(h[i].style.opacity=1-t)}catch(s){console.log(194,e,t,i)}}aotoplay(){return(()=>{const t=this.index;this.index+=1,this.index>this.length-1&&(this.index=0);const e=this.index;this.callback(e),this.startMove(0,1,h,(i=>{this.fadeMove(i,e,t)})).then((()=>{this.enter(this.index)}))})()}fadeProcess(t,e){const i=this.length-1,s=this.index;let h=this.index;t<0?(h+=1,h>i&&(h=0)):(h-=1,h<0&&(h=i)),s!==parseInt(s+"")&&console.log(11111),this.fadeMove(e,s,h)}fadeSetIndex(t){const e=this.loop,i=this.index;return t>0&&(this.index-=1,this.index<0&&(this.index=e?this.length-1:0)),t<0&&(this.index+=1,this.index>this.length-1&&(this.index=e?0:this.length-1)),i===this.index||this.callback(this.index),this.index}destroy(){this.clear(),this.slider.removeEventListener("touchstart",this._start,this.will),this.slider.removeEventListener("touchmove",this._move,this.will),this.slider.removeEventListener("touchend",this._end,this.will),this.slider.removeEventListener("mousedown",this._start,this.will),this.slider.removeEventListener("mousemove",this._move,this.will),this.slider.removeEventListener("mouseup",this._end,this.will),this.slider.removeEventListener("click",this._closeDefault,!0),document.addEventListener("visibilitychange",this._visibilitychange)}}return{createSlideSwiper:t=>new s(t),cresteFadeSwiper:t=>new n(t)}}));
